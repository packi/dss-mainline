<html>
  <head>
    <title>digitalStrom - Server</title>
	<script src="prototype.js" language="JavaScript" type="text/javascript"></script>
	<script type="text/javascript" language="JavaScript">
	
	function turnOn(devid) {
	  new Ajax.Request('/json/turnon', 
	    {
	      method:'get', 
	      parameters: {device: devid},
          onComplete: function(transport, json) {
            doUpdate();
          }
	    } 
	  );
	}
	
	function turnOff(devid) {
	  new Ajax.Request('/json/turnoff',
	    {
	      method:'get', 
	      parameters: {device: devid},
          onComplete: function(transport, json) {
            doUpdate();
          }
	    } 
	  );
	}
	
	function update(devices) {
	  $('numDevs').innerHTML = devices.length;
	  var devslist = "<ul>";
	  for(i = 0; i < devices.length; i++) {
	    var dev = devices[i];
	    devslist += "<li>" + dev.name;
		if(dev.on) {
		  devslist += "&nbsp; On";
		} else {
		  devslist += "&nbsp; Off";
		}
	    devslist += '&nbsp;<a href="#" onclick="turnOn(' + dev.id + ')">Turn On</a>';
	    devslist += '&nbsp;<a href="#" onclick="turnOff(' + dev.id + ')">Turn Off</a>';
	    devslist += "</li>";
	    
	  }
	  devslist += "</ul>";
	  $('devList').innerHTML = devslist;
	}
	
	function doUpdate() {
  	  new Ajax.Request(
	    '/json/getdevices', 
	    { method:'get',
          onComplete: function(transport, json) {
            update(transport.responseJSON.devices);
          }
        }
	  );
	}
	
	function raiseEvent() {
	  new Ajax.Request('/json/event/raise',
	    {
	      method:'get', 
	      parameters: 
	        { 
	          evtid: $F('evtid'),
	          sourceid: $F('eventsrc')
	        }
	    } 
	  );
	}
	
	function scheduleEvent() {
	  new Ajax.Request('/json/event/schedule',
	    {
	      method:'get', 
	      parameters: 
	        { 
	          evtid: $F('evtid'),
	          sourceid: $F('eventsrc'),
	          schedule: $F('eventsched'),
	          start: $F('eventstart')
	        }
	    } 
	  );
	}
  
	doUpdate();	
</script>
  </head>
  <body>
    <h1>Welcome to the dSS!</h1>
	<ul>
	  <li><a href="config">Config</a></li>
	  <li><a href="addevent.html">Add Event</a></li>
	  <li><a href="scripts">Scripts</a></li>
	<!--  <li><a href="events">Events</a></li> -->
	</ul>
	<form>
	<h2>Event Raising / Scheduling</h2>
	  Event ID: <input type="text" id="evtid" value="1001"/><br />
	  Event Source: <input type="text" id="eventsrc" value="1"/><br />
	  Event Schedule: <input type="text" id="eventsched" value="FREQ=MINUTELY;INTERVAL=2"/><br />
	  Event Start: <input type="text" id="eventstart" value="20080520T080000"/><br />
	  <a href="#" onclick="raiseEvent()">Raise</a>
	  <a href="#" onclick="scheduleEvent()">Schedule</a>
	</form>
	<form>
	Connected devices: <span id="numDevs">(...loading...)</span>
	<div id="devList">
	</div>
	</form>
  </body>	
</html>