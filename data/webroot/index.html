<html>
  <head>
    <title>digitalStrom - Server</title>
	<script src="prototype.js" language="JavaScript" type="text/javascript"></script>
	<script type="text/javascript" language="JavaScript">
	
	function turnOn(devid) {
	  new Ajax.Request('/json/turnon', 
	    {
	      method:'get', 
	      parameters: {device: devid},
          onComplete: function(transport, json) {
            doUpdate();
          }
	    } 
	  );
	}
	
	function turnOff(devid) {
	  new Ajax.Request('/json/turnoff',
	    {
	      method:'get', 
	      parameters: {device: devid},
          onComplete: function(transport, json) {
            doUpdate();
          }
	    } 
	  );
	}
	
	function update(devices) {
	  $('numDevs').innerHTML = devices.length;
	  var devslist = "<ul>";
	  for(i = 0; i < devices.length; i++) {
	    var dev = devices[i];
	    devslist += "<li>" + dev.name;
		if(dev.on) {
		  devslist += "&nbsp; On";
		} else {
		  devslist += "&nbsp; Off";
		}
	    devslist += '&nbsp;<a href="#" onclick="turnOn(' + dev.id + ')">Turn On</a>';
	    devslist += '&nbsp;<a href="#" onclick="turnOff(' + dev.id + ')">Turn Off</a>';
	    devslist += "</li>";
	    
	  }
	  devslist += "</ul>";
	  $('devList').innerHTML = devslist;
	}
	
	function doUpdate() {
  	  new Ajax.Request(
	    '/json/getdevices', 
	    { method:'get',
          onComplete: function(transport, json) {
            update(transport.responseJSON.devices);
          }
        }
	  );
	}
  
	doUpdate();	
</script>
  </head>
  <body>
    <h1>Welcome to the dSS!</h1>
	<ul>
	  <li><a href="config">Config</a></li>
	<!--  <li><a href="events">Events</a></li> -->
	</ul>
	<form>
	Connected devices: <span id="numDevs">(...loading...)</span>
	<div id="devList">
	</div>
	</form>
  </body>	
</html>