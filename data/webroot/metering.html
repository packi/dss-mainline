<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<script type="text/javascript" src="js/lib/jquery/jquery.js"></script>
		<script type="text/javascript" src="js/lib/prototype/prototype.js"></script>
		<!-- [if IE]>
			<script type="text/javascript" src="js/lib/flot/excanvas.pack.js"></script>
		<![endif] -->
		<script type="text/javascript" src="js/lib/flot/jquery.flot.pack.js"></script>
		<script type="text/javascript" src="js/DSGraph.js"></script>
		<script type="text/javascript" src="js/DSMainMeterReport.js"></script>
		<script type="text/javascript" src="js/model.js"></script>
		<link rel="stylesheet" href="css/meteringDemoStyle.css" type="text/css"/>
		<script type="text/javascript">
var graph;
var reporter;
jQuery(document).ready(function() {

	var apart = new Apartment();
	apart.fetch();
	var circuits = apart.getCircuits();
	
	jQuery("#series").append("<li id=\"meter\">Main Meter<\/li>");
	jQuery("h2").css({fontSize: "x-large"});
	jQuery("#series").css({fontSize: "medium"});
	jQuery("#meter").click(function() {
		jQuery("#series li").css({color: "#666666"});
		jQuery(this).css({color: "red"});
		graph.setDSM("metering");
	});
	
	jQuery(circuits).each(function() {
		var id = this.dsid;
		if(this.name !== "") {
			jQuery("#series").append("<li id=" + id + ">" + this.name + "<\/li>");
		} else {
			jQuery("#series").append("<li id=" + id + ">" + id + "<\/li>");
		}
		jQuery("#" + id).click(function() {
			jQuery("#series li").css({color: "#666666"});
			jQuery(this).css({color: "red"});
			graph.setDSM(id);
		});
	});
	
	jQuery("#graphSelector > li").each(function() {
		jQuery(this).click(function() {
			jQuery("#graphSelector li.selected").removeClass("selected");
			jQuery(this).addClass("selected");
			if(jQuery(this).data("hovering") == true) {
				jQuery(this).data("hovering", false);
			}
			graph.setResolution(jQuery(this).attr("id"));
		});
		jQuery(this).hover(function() {
			if(jQuery(this).hasClass("selected")) {
				jQuery(this).data("hovering", false);
			} else {
				jQuery(this).addClass("selected");
				jQuery(this).data("hovering", true);
			}
		}, function() {
			if(jQuery(this).data("hovering") == true) {
				jQuery(this).removeClass("selected");
				jQuery(this).data("hovering", false);
			}
		})
	});
	
	graph = new DSGraph(circuits[0].dsid);
	jQuery("#" + circuits[0].dsid).css({color: "red"});
	graph.start();
	
	jQuery("#showRawXML").click(function() {
		jQuery("#rawDataOverlay").css({
				display: "block",
				opacity: 0.0
			}).animate({
				opacity: 0.8
			}, 1000, null, null);
			jQuery("#rawDataOverlayBox").fadeIn(1000);
	});
	jQuery("#hideXML").click(function() {
		jQuery("#rawDataOverlayBox").fadeOut(1000);
		jQuery("#rawDataOverlay").animate({
			opacity: 0.0
		}, 1000, null, function() {
			jQuery(this).css({display: "none"});
		});
	});
});

// 	registerHandlers();
// 	updatePowerConsumptionOverlays();
// 	graph = new DSGraph("0000000000000000ffc00011");
// 	graph.start();
// 	reporter = new DSMainMeterReport();
// 	reporter.start();

// 	});

		</script>
		<title>aizo Metering Charts powered by futureLAB</title>
	</head>
	<body>
		<div id="main">
			<h1 id="header">aizo Metering Charts powered by futureLAB</h1>
			<div id="navigation">
			</div>
			<div id="content">
				<div id="building">
					<h2>Messreihe</h2>
					<ul id="series">
					</ul>
				</div>
				<div id="charts">
					<h2>Verbrauch</h2>
					<ul id="graphSelector">
						<li id="five_minutes" class="selected">letzte 5 Min.</li>
						<li id="one_hour">letzte Std.</li>
						<li id="one_day">letzter Tag</li>
						<li id="one_week">letzte Woche</li>
						<li id="one_month">letzter Monat</li>
						<li id="one_year">letztes Jahr</li>
					</ul>
					<div id="graph">
						<div id="curve"></div>
					</div>
					<div id="showRawXML"></div>
				</div>
			</div>
			<div id="footer">
			</div>
		</div>
		<div id="rawDataOverlay"></div>
		<div id="rawDataOverlayBox">
			<div id="hideXML">Hide XML</div>
			<div id="xml"></div>
		</div>
	</body>
</html>
